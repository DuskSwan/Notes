面对很多组样本，我们自然地希望将它们分为几个类别，每一类中的样本彼此相似。这一任务称为聚类。



# 聚集系统法

聚集系统法与分割系统法通常系统的聚类方法（hierarchical clustering method，也称层次聚类法）。其基本思路是，从各自为类或者全为同类开始，按照某个准则不断地合并小类别或者划分大类别，直到类别数满足我们的要求。前者称为聚集的（agglomeration）方法，后者称为分割的（divisive）方法。

### 思路

聚集的系统聚类法，也即从各自为类开始，逐渐地合并子类。这一方法的过程是：

1. 规定样本之间的距离$d$，进而规定出每个类别$G_i$之间的距离。
1. 对于当前的$m$个类$G_1,G_2,\cdots,G_m$，计算两两之间的距离，写成对称矩阵$D$。
1. $D$中会有一个最小元，其对应的两个类$G_K$与$G_L$就是当前离得最近的两个类，将它们合并。
1. 重复步骤2，也即重新计算距离矩阵$D$。直到只剩下一个类为止。通过选取合适的合并次数，就可以得到对应的类别数目。

### 样本距离

常用的距离（事实上，不符合“距离”定义的衡量标准也能拿来用，可以称之为相似系数）包括：

1. Minkowski距离/q-范数
   $$
   d(x,y)=\left(\sum_{i=1}^p|x_i-y_i|^q\right)^\frac1q
   $$


   $q=1$时称绝对值距离，$q=2$时称欧式距离，$q=\infty$时称切比雪夫距离（此时$d(x,y)=\max\limits_{1\leqslant i\leqslant p}|x_i-y_i|$）。一般来说，$q$越大，差异大的分量对距离起的作用就越大，因而距离对异常值越敏感。使用该距离通常要做标准化。

1. 兰氏（Lance和Williams）距离
   $$
   d(x,y)=\sum_{i=1}^p \frac{|x_i-y_i|}{x_i+y_i}
   $$
   由于除以了分量之和，所以该距离不受变量的尺度影响，适用于偏斜或者异常值多的数据。

1. 马氏距离
   $$
   d(x,y)=\sqrt{(x-y)'S^{-1}(x-y)}
   $$
   即考虑了样本相关性后给出的便于分类的距离。但在聚类分析中，不同的类意味着不同的协方差矩阵$S$，使用起来较为繁琐。

### 类别距离

衡量类别之间距离的方法不同，带来了不同的聚类系统法，包括：

1. 最短距离法/单连接法

   以两类之间距离最近的样本距离为类的距离，即$D_{KL}=\min\limits_{i\in G_K,j\in G_L}d_{ij}$。该方法在合并之后可以递推得出新的距离，无需重新计算。该方法对分散的样本效果不好。且会有挑选长链状聚类的倾向。

1. 最长距离法/完全连接法

   以两类之间距离最远的样本距离为类的距离，即$D_{KL}=\max\limits_{i\in G_K,j\in G_L}d_{ij}$。该方法在合并之后可以递推得出新的距离，无需重新计算。该方法受异常值的影响较大。

1. 类平均法/平均连接法

   两类之间的点两两之间可以得到很多距离，以这些距离的平均数作为类别距离的代表，即$D_{KL}=\displaystyle\frac1{n_Kn_L}\sum\limits_{i\in G_K,j\in G_L}d_{ij}$。也可以定义为样本距离平方的均值再开方。

1. 重心法

   以两类各自重心之间的欧氏距离为类的距离。即$D_{KL}=d_{\bar{x}_K,\bar{x}_L}=\sqrt{(\bar{x}_K-\bar{x}_L)'(\bar{x}_K-\bar{x}_L)}$。该方法在合并之后可以递推得出新的距离，无需重新计算。且在异常值方面比较稳健。

1. 离差平方和法

   先定义每一类的离差平方和为类中每个样本到重心的欧氏距离平方和，也即$W_K=\sum\limits_{i\in G_K}(x_i-\bar{x}_K)'(x_i-\bar{x}_K)$。如果两类$G_K$与$G_L$合并成新类$G_M$，那么总的离差平方和就增加了$W_M-W_K-W_L$，我们就定义这两类之间的平方距离为$D_{KL}^2=W_M-W_K-W_L$。经过推导，可以化简为$D_{KL}^2=\displaystyle\frac{n_K n_L}{n_K+n_L}(\bar{x}_K-\bar{x}_L)'(\bar{x}_K-\bar{x}_L)$。



# k均值法

k均值法属于一种动态聚类法，也即不断地修改每个点的分类（动态地调整），直到每个点的归属变得稳定。

### 思路

指定类的目标数目k。一开始将样本分为k个初始类，之后逐个判断每个样本，将它们归入距离（通常是欧氏距离）最近的类，不断循环这一过程，直到全部的样本归属不再改变。

